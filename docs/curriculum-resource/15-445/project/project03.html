<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-curriculum-resource/15-445/project/project03" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Project 02 | CS自学社区</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.learncs.site/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.learncs.site/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.learncs.site/docs/curriculum-resource/15-445/project/project03"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="baidu-site-verification" content="codeva-hJyfN2UKgo"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Project 02 | CS自学社区"><meta data-rh="true" name="description" content="Remember to pull the latest code from the bustub repository. Do not post your code on a public GitHub repository."><meta data-rh="true" property="og:description" content="Remember to pull the latest code from the bustub repository. Do not post your code on a public GitHub repository."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.learncs.site/docs/curriculum-resource/15-445/project/project03"><link data-rh="true" rel="alternate" href="https://www.learncs.site/docs/curriculum-resource/15-445/project/project03" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.learncs.site/docs/curriculum-resource/15-445/project/project03" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CS自学社区 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CS自学社区 Atom Feed">




<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/assets/css/styles.c4382977.css">
<link rel="preload" href="/assets/js/runtime~main.30603f7d.js" as="script">
<link rel="preload" href="/assets/js/main.b37f8dfa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">🎉️🎉️🎉️课程文档汉化工作正在进行中 🎉️🎉️ 学习交流群请到 <a href="/community">社区页面</a> 查看入群方式 🎉️🎉️🎉️</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="TeachYourselfCS" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="TeachYourselfCS" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">TeachYourselfCS</b></a><a class="navbar__item navbar__link" href="/docs/roadmap">路线图</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">课程资源</a><a class="navbar__item navbar__link" href="/blog">博客</a><a class="navbar__item navbar__link" href="/community">社区</a><a class="navbar__item navbar__link" href="/donate">捐赠我们</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">前言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/roadmap">路线图</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/课程资源">课程资源</a><button aria-label="Toggle the collapsible sidebar category &#x27;课程资源&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs50x">cs50x</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs50x&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs61a">cs61a</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs61a&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs61b">cs61b</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs61b&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs61c">cs61c</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs61c&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/18-01">MIT 18.01</a><button aria-label="Toggle the collapsible sidebar category &#x27;MIT 18.01&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/18-02">MIT 18.02</a><button aria-label="Toggle the collapsible sidebar category &#x27;MIT 18.02&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/18-06">MIT 18.06</a><button aria-label="Toggle the collapsible sidebar category &#x27;MIT 18.06&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/6-04j">MIT 6.042J</a><button aria-label="Toggle the collapsible sidebar category &#x27;MIT 6.042J&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs162">cs162</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs162&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs144">cs144</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs144&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/curriculum-resource/15-445">CMU 15-445</a><button aria-label="Toggle the collapsible sidebar category &#x27;CMU 15-445&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/15-445/assignments">assignments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/15-445/syllabus">syllabus-课程大纲</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/15-445/homework/homework01">homework</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/curriculum-resource/15-445/project/project01">project</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/15-445/project/project01">Project 0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/15-445/project/project02">Project 01</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/curriculum-resource/15-445/project/project03">Project 02</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/15-445/project/project04">Project 03</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/15-445/project/project05">Project 04</a></li></ul></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/课程资源"><span itemprop="name">课程资源</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/curriculum-resource/15-445"><span itemprop="name">CMU 15-445</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">project</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Project 02</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Project 02</h1></header><p>Remember to pull the latest code from the bustub repository. Do not post your code on a public GitHub repository.</p><h1>Overview</h1><p>In this project you will implement a <a href="https://en.wikipedia.org/wiki/B%2B_tree" target="_blank" rel="noopener noreferrer">B+Tree</a> index in your database system.
A B+Tree is a balanced search tree in which the internal pages direct the search and leaf pages contain the actual data entries.
The index provides fast data retrieval without needing to search every row in a database table, enabling rapid random lookups and efficient scans of ordered records.
Your implementation will support thread-safe search, insertion, deletion (including splitting and merging nodes), and an iterator to support in-order leaf scans. You need to complete the following tasks:</p><ul><li><a href="https://15445.courses.cs.cmu.edu/fall2024/project2/#btree-pages" target="_blank" rel="noopener noreferrer">Task #1 - B+Tree Pages</a></li><li><a href="https://15445.courses.cs.cmu.edu/fall2024/project2/#btree-operations" target="_blank" rel="noopener noreferrer">Task #2 - B+Tree Operations (Insertion, Deletion, and Point Search)</a></li><li><a href="https://15445.courses.cs.cmu.edu/fall2024/project2/#index-iterator" target="_blank" rel="noopener noreferrer">Task #3 - Index Iterator</a></li><li><a href="https://15445.courses.cs.cmu.edu/fall2024/project2/#concurrency-control" target="_blank" rel="noopener noreferrer">Task #4 - Concurrency Control</a></li></ul><p>Your work in Project #2 depends on your implementation of the buffer pool and page guards from Project #1.
If your Project #1 solution is incorrect, you <strong>MUST</strong> fix it to successfully complete this project.
This project must be completed <strong>individually</strong> (i.e., no groups).</p><ul><li><strong>Release Date:</strong> Sep 30, 2024</li><li><strong>Due Date:</strong> Oct 27, 2024 @ 11:59pm</li></ul><p>This project is more difficult than previous projects/homework! We strongly recommend that you START EARLY or you will have problems.</p><p>You have been warned!</p><h1>Project Specification</h1><p>We have provided stub classes that define the APIs that you must implement. You should <strong>not</strong> modify the signatures of these pre-defined functions; if you do, our test code will not work and you will receive little or no credit for the project.
Similarly, you should not remove existing member variables from the code we provide.
You may add functions and member variables to these classes to implement your solution.</p><p>Before you start, run <code>git pull public master</code> to pull the latest code from the public <a href="https://github.com/cmu-db/bustub" target="_blank" rel="noopener noreferrer">BusTub repository</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-1---btree-pages">Task <!-- -->#<!-- -->1 - B+Tree Pages<a href="#task-1---btree-pages" class="hash-link" aria-label="Direct link to task-1---btree-pages" title="Direct link to task-1---btree-pages">​</a></h2><p>You must implement the following three <code>Page</code> classes to store the data of your B+Tree.</p><ul><li><a href="https://15445.courses.cs.cmu.edu/fall2024/project2/#btree-page" target="_blank" rel="noopener noreferrer">B+Tree Page</a></li><li><a href="https://15445.courses.cs.cmu.edu/fall2024/project2/#btree-internal-page" target="_blank" rel="noopener noreferrer">B+Tree Internal Page</a></li><li><a href="https://15445.courses.cs.cmu.edu/fall2024/project2/#btree-leaf-page" target="_blank" rel="noopener noreferrer">B+Tree Leaf Page</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="base-page">Base Page<a href="#base-page" class="hash-link" aria-label="Direct link to Base Page" title="Direct link to Base Page">​</a></h3><p>This is a base class that the Internal Page and Leaf Page inherit from, and contains only information that both child classes share.
The B+Tree Page has the following fields:</p><table><thead><tr><th>Variable Name</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>page<!-- -->_<!-- -->type<!-- -->_</td><td>4</td><td>Page type (invalid page / leaf page / internal page)</td></tr><tr><td>size<!-- -->_</td><td>4</td><td>Number of key &amp; value pairs in a page</td></tr><tr><td>max<!-- -->_<!-- -->size<!-- -->_</td><td>4</td><td>Max number of key &amp; value pairs in a page</td></tr></tbody></table><p>You must implement the B+Tree Page by modifying only its header file ( <a href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/page/b_plus_tree_page.h" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/include/storage/page/b_plus_tree_page.h</code></a>) and the corresponding source file ( <a href="https://github.com/cmu-db/bustub/blob/master/src/storage/page/b_plus_tree_page.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/storage/page/b_plus_tree_page.cpp</code></a>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="internal-page">Internal Page<a href="#internal-page" class="hash-link" aria-label="Direct link to Internal Page" title="Direct link to Internal Page">​</a></h3><p>An Internal Page (i.e., inner node) stores <code>m</code> ordered keys and <code>m + 1</code> child pointers (i.e. page<!-- -->_<!-- -->ids) to other B+Tree Pages.
These keys and pointers are internally represented as an array of key/page<!-- -->_<!-- -->id pairs.
As the number of child pointers is one more than the number of keys, the first key in <code>key_array_</code> (see <a href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/page/b_plus_tree_internal_page.h/%3C/tt%3E" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/include/storage/page/b_plus_tree_internal_page.h</code></a>) is set to be invalid, and lookups should always start from the second key.</p><p>At any time, each internal page should be at least half full. During deletion, two half-full pages can be merged, or keys and pointers can be redistributed to avoid merging.
During insertion, one full page can be split into two, or keys and pointers can be redistributed to avoid splitting.
These are examples of the many design choices that you will make while implementing your B+Tree.</p><p>You must implement the Internal Page by modifying only its header file ( <a href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/page/b_plus_tree_internal_page.h" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/include/storage/page/b_plus_tree_internal_page.h</code></a>&#x27;) and the corresponding source file ( <a href="https://github.com/cmu-db/bustub/blob/master/src/storage/page/b_plus_tree_internal_page.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/storage/page/b_plus_tree_internal_page.cpp</code></a>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="leaf-page">Leaf Page<a href="#leaf-page" class="hash-link" aria-label="Direct link to Leaf Page" title="Direct link to Leaf Page">​</a></h3><p>The Leaf Page stores <code>m</code> ordered keys and their <code>m</code> corresponding values.
In your implementation, the value should always be the 64-bit record id for where the actual tuples are stored -- see the <code>RID</code> class, in <a href="https://github.com/cmu-db/bustub/blob/master/src/include/common/rid.h" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/include/common/rid.h</code></a>.
Leaf pages have the same restrictions on the number of key/value pairs as Internal pages, and should follow the same operations for merging, splitting, and redistributing keys.</p><p>You must implement your Leaf Page by modifying only its header file ( <a href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/page/b_plus_tree_leaf_page.h" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/include/storage/page/b_plus_tree_leaf_page.h</code></a>) and corresponding source file ( <a href="https://github.com/cmu-db/bustub/blob/master/src/storage/page/b_plus_tree_leaf_page.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/storage/page/b_plus_tree_leaf_page.cpp</code></a>).</p><p><strong>Note:</strong> Even though Leaf Pages and Internal Pages contain the same key type, they may have different value types. Thus, the <code>max_size</code> can be different.</p><p>Each B+Tree leaf/internal page corresponds to the content (i.e., the <code>data_</code> part) of a memory page fetched by the buffer pool.
Every time you read or write from/to a leaf or internal page, you must first fetch the page from the buffer pool (using its unique <code>page_id</code>),
<a href="http://en.cppreference.com/w/cpp/language/reinterpret_cast" target="_blank" rel="noopener noreferrer">reinterpret cast</a> it to either a leaf or an internal page, and unpin the page after reading or writing from/to it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-2---btree-operations-insertion-deletion-and-point-search">Task <!-- -->#<!-- -->2 - B+Tree Operations (Insertion, Deletion, and Point Search)<a href="#task-2---btree-operations-insertion-deletion-and-point-search" class="hash-link" aria-label="Direct link to task-2---btree-operations-insertion-deletion-and-point-search" title="Direct link to task-2---btree-operations-insertion-deletion-and-point-search">​</a></h2><p>In this task, your B+Tree Index needs to support insertion ( <code>Insert()</code>), deletion ( <code>Delete()</code>), and search ( <code>GetValue()</code>) for single values.
The index should support only unique keys; if you try to reinsert an existing key into the index, insertion should not be performed and <code>false</code> will be returned.</p><p>B+Tree pages should be split (or keys should be redistributed) if an insertion would violate the B+Tree&#x27;s invariants.
If an insertion changes the page ID of the root, you must update the <code>root_page_id</code> in the B+Tree index&#x27;s header page.
You can do this by accessing the <code>header_page_id_</code> page, which is given to you in the constructor.
Then, by using <a href="http://en.cppreference.com/w/cpp/language/reinterpret_cast" target="_blank" rel="noopener noreferrer">reinterpret cast</a>, you can interpret this page as a <code>BPlusTreeHeaderPage</code> (from <a href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/page/b_plus_tree_header_page.h" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/include/storage/page/b_plus_tree_header_page.h</code></a>) and update the root page ID from there.
You also must implement <code>GetRootPageId</code>.</p><p>Similarly, your B+Tree Index must support including merging or redistributing keys between pages if necessary to maintain the B+Tree invariants when deleting a key.
As with insertions, you must correctly update the B+Tree&#x27;s root page ID if the root changes.</p><p>We recommend that you use the page guard classes from Project #1 to avoid synchronization problems.
You should use <code>ReadPage</code> or <code>WritePage</code> accordingly.</p><p>You may optionally use the <code>Context</code> class (defined in <a href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/index/b_plus_tree.h" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/include/storage/index/b_plus_tree.h</code></a>) to track the pages that you&#x27;ve read or written (via the <code>read_set_</code> and <code>write_set_</code> fields) or to store other metadata that you need to pass into other functions recursively.</p><p>If you are using the <code>Context</code> class, here are some tips:</p><ul><li>You might only need to use <code>write_set_</code> when inserting or deleting. It is possible that you do not use <code>read_set_</code>, depending on your implementation.</li><li>You might want to store the root page id in the context and acquire write guard of header page when modifying the B+Tree.</li><li>To find a parent of the current node, look at the back of <code>write_set_</code>. It should contain all nodes along the access path.</li><li>You may use <code>BUSTUB_ASSERT</code> to help you find inconsistent data in your implementation. For example, if you want to split a node (except root), you should ensure that there is still at least one node in the <code>write_set_</code>. If you need to split root, you should check if <code>header_page_</code> is <code>std::nullopt</code>.</li><li>To unlock the header page, simply set <code>header_page_</code> to <code>std::nullopt</code>. To unlock other pages, pop from the <code>write_set_</code> and drop.</li></ul><p>The B+Tree is parameterized on arbitrary key, value, and key comparator types.
We&#x27;ve defined a macro, <code>INDEX_TEMPLATE_ARGUMENTS</code>, that generates the template parameter declaration for you:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">template &lt;typename KeyType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          typename ValueType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          typename KeyComparator&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The type parameters are:</p><ul><li><code>KeyType</code>:
The type of each key in the index. In practice this will be a <code>GenericKey</code>. The actual size of a <code>GenericKey</code> varies, and is specified with its own template argument that depends on the type of indexed attribute.</li></ul><ul><li><code>ValueType</code>:
The type of each value in the index. In practice, this will be a 64-bit RID.</li></ul><ul><li><code>KeyComparator</code>:
A class used to compare whether two <code>KeyType</code> instances are less than, greater than, or equal to each other. These will be included in the <code>KeyType</code> implementation files.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-3---index-iterator">Task <!-- -->#<!-- -->3 - Index Iterator<a href="#task-3---index-iterator" class="hash-link" aria-label="Direct link to task-3---index-iterator" title="Direct link to task-3---index-iterator">​</a></h2><p>After you have implemented and thoroughly tested your B+Tree in Tasks #1 and #2, you must add a C++ iterator that efficiently supports an in-order scan of the data in the leaf pages.
The basic idea is store sibling pointers so that you can efficiently traverse the leaf pages, and then implement an iterator that iterates through every key-value pair, in order, in every leaf page.</p><p>Your iterator must be a <a href="http://www.cplusplus.com/reference/iterator/" target="_blank" rel="noopener noreferrer">C++17-style Iterator</a>, including at least the following methods:</p><ul><li><code>isEnd()</code>:
Return whether this iterator is pointing at the last key/value pair.</li></ul><ul><li><code>operator++()</code>:
Move to the next key/value pair.</li></ul><ul><li><code>operator*()</code>:
Return the key/value pair this iterator is currently pointing at.</li></ul><ul><li><code>operator==()</code>:
Return whether two iterators are equal.</li></ul><ul><li><code>operator!=()</code>:
Return whether two iterators are not equal.</li></ul><p>Your <code>BPlusTree</code> also must correctly implement <code>begin()</code> and <code>end()</code> methods, to support C++ for-each loop functionality on the index.</p><p>You must implement your index iterator by modifying only its header file ( <a href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/index/index_iterator.h" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/include/storage/index/index_iterator.h</code></a>) and corresponding source file ( <a href="https://github.com/cmu-db/bustub/blob/master/src/index/storage/index_iterator.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>src/index/storage/index_iterator.cpp</code></a>).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-4---concurrency-control">Task <!-- -->#<!-- -->4 - Concurrency Control<a href="#task-4---concurrency-control" class="hash-link" aria-label="Direct link to task-4---concurrency-control" title="Direct link to task-4---concurrency-control">​</a></h2><p>In the last task, you will modify your B+Tree implementation so that it safely supports concurrent operations.
You should use the latch coupling/crabbing technique described in class and in the textbook.
The thread traversing the index should acquire latches on B+Tree pages as necessary to ensure safe concurrent operations, and should release latches on parent pages as soon as possible when it is safe to do so.</p><p><strong>Note:</strong> You should never acquire the same read lock twice in a single thread. It might lead to deadlock.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="leaderboard-task-optional">Leaderboard Task (Optional)<a href="#leaderboard-task-optional" class="hash-link" aria-label="Direct link to Leaderboard Task (Optional)" title="Direct link to Leaderboard Task (Optional)">​</a></h2><p>The leaderboard task is a measurement of how fast your B+Tree Index compared to other students&#x27; implementations. The B+Tree benchmark runner ( <a href="https://github.com/cmu-db/bustub/blob/master/tools/btree_bench/btree_bench.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>tools/btree_bench/btree_bench.cpp</code></a>) uses multiple threads to concurrently read and update the index using different access patterns.</p><p>Optimizing for the leaderboard is optional (i.e., you can get a perfect score in the project after finishing all previous tasks).
However, your solution must finish the leaderboard test with a correct result and without deadlock and segfault.</p><p><strong>Recommended Optimizations:</strong></p><ul><li><p>For deletion, place tombstones in the leaf instead of doing actual deletions. Then clean up tombstones in the background or after some thresholds.</p></li><li><p>Optimistically acquire read locks for all modification operations because trees will split and coalesce less often.</p></li></ul><p>Similar techniques are described in the Bε-tree paper.</p><h1>Instructions</h1><p>See the <a href="https://15445.courses.cs.cmu.edu/fall2024/project0/#instructions" target="_blank" rel="noopener noreferrer">Project #0 instructions</a> on how to create your private repository and setup your development environment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-roadmap">Development Roadmap<a href="#development-roadmap" class="hash-link" aria-label="Direct link to Development Roadmap" title="Direct link to Development Roadmap">​</a></h2><p>There are several ways in which you could go about building a B+Tree Index.
This road map only serves as a rough conceptual guideline, which is based on the algorithm outlined in the textbook.
You could end up with a semantically correct B+Tree that passes all our tests even without strictly following the roadmap.
The choice is entirely yours.</p><ol><li><strong>Simple Inserts:</strong>
Given a key-value pair KV and a non-full node N, insert KV into N. Self check: What are the different types of nodes and can key-values be inserted in all of them?</li></ol><ol start="2"><li><strong>Simple Search:</strong>
Given a key K, define a search mechanism on the tree to determine the presence of the key.
Self check: Can keys exist in multiple nodes and are all these keys the same?</li></ol><ol start="3"><li><strong>Simple Splits:</strong>
Given a key K, and a target leaf node L that is full, insert the key into the tree, while keeping the tree consistent. Self check: When do you choose to split a node and how to define a split?</li></ol><ol start="4"><li><strong>Multiple Splits:</strong>
Define inserts for a key K on a leaf node L that is full, whose parent node M is also full. Self check: What happens when the parent of M is also full?</li></ol><ol start="5"><li><strong>Simple Deletes:</strong>
Given a key K and a target leaf node L that is at-least half full, delete K from L. Self check: Is the leaf node L the only node that contains the key K?</li></ol><ol start="6"><li><strong>Simple Coalesces:</strong>
Define deletion for a key K on a leaf node L that is less than half-full after the delete operation. Self check: Is it mandatory to coalesce when L is less than half-full and how do you choose which node to coalesce with?</li></ol><ol start="7"><li><strong>Not-So-Simple Coalesces:</strong>
Define deletion for a key K on a node L that contains no suitable node to coalesce with. Self check: Does coalescing behavior vary depending on the type of nodes? This should take you through to Task 1 and 2.</li><li><strong>Index Iterators:</strong>
The section on <a href="https://15445.courses.cs.cmu.edu/fall2024/project2/#index-iterator" target="_blank" rel="noopener noreferrer">Task #3</a> describes the implementation of an iterator for the B+Tree.</li></ol><ol start="9"><li><strong>Concurrent Indexes:</strong>
The section on <a href="https://15445.courses.cs.cmu.edu/fall2024/project2/#concurrency-control" target="_blank" rel="noopener noreferrer">Task #4</a> describes the implementation of the latch crabbing technique to support concurrency in your design.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements-and-hints">Requirements and Hints<a href="#requirements-and-hints" class="hash-link" aria-label="Direct link to Requirements and Hints" title="Direct link to Requirements and Hints">​</a></h2><ul><li>You are <strong>not</strong> allowed to use a global latch to protect your data structure; your implementation must support a reasonable level of concurrency. In other words, you may not latch the whole index and only unlatch when operations are done.</li><li>We recommend that you use the page guard classes <code>ReadPageGuard</code> and <code>WritePageGuard</code> to implement thread safety for your B+Tree. You can receive full credit on this project if you use these constructs correctly.</li><li>You may add functions to your implementation as long as you keep all our original public interfaces intact for testing purposes.</li><li>Do not use <code>malloc</code> or <code>new</code> to allocate large blocks of memory for your tree. If you need to need to create a new node for your tree or need a buffer for some operation, you should use the buffer pool manager.</li><li>Use binary search to find the place to insert a value when iterating an internal or leaf node. Otherwise, your implementation will probably timeout on Gradescope.</li><li>We recommend (but do not require) that you to follow this rule when implementing split: split a leaf node when the number of values reaches <code>max_size</code> after insertion, and split an internal node when number of values reaches <code>max_size</code> before insertion. This will ensure that an insertion to a leaf node will never cause a page data overflow when you do something like <code>InsertIntoLeaf</code> and then redistribute; it will also prevent an internal node with only one child. However, you indeed can do something like lazily splitting leaf node / handling the case for internal node of only one children. It is up to you; our test cases do not test for these conditions.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="common-pitfalls">Common Pitfalls<a href="#common-pitfalls" class="hash-link" aria-label="Direct link to Common Pitfalls" title="Direct link to Common Pitfalls">​</a></h2><ul><li>We do not test your iterator for thread-safe leaf scans. A correct implementation, however, would require the Leaf Page to throw a <code>std::exception</code> when it cannot acquire a latch on its sibling to avoid potential dead-locks.</li></ul><ul><li>If you implement a concurrent B+Tree index correctly, every thread will always acquire latches from the header page to the bottom. When you release latches, make sure you release them in the same order (from the header page to the bottom).</li></ul><ul><li>When implementing the page classes (Task 1), make sure you only add class fields of trivially-constructed types (e.g. <code>int</code>). Do not add vectors and do not modify <code>key_array_</code> and <code>value_array_</code>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h2><p>Unlike in the previous projects, we are making all the grading tests available to you to run locally. Your implementation must pass the following tests:</p><ul><li><a href="https://github.com/cmu-db/bustub/blob/master/test/storage/b_plus_tree_insert_test.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>test/storage/b_plus_tree_insert_test.cpp</code></a></li><li><a href="https://github.com/cmu-db/bustub/blob/master/test/storage/b_plus_tree_sequential_scale_test.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>test/storage/b_plus_tree_sequential_scale_test.cpp</code></a></li><li><a href="https://github.com/cmu-db/bustub/blob/master/test/storage/b_plus_tree_delete_test.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>test/storage/b_plus_tree_delete_test.cpp</code></a></li><li><a href="https://github.com/cmu-db/bustub/blob/master/test/storage/b_plus_tree_concurrent_test.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>test/storage/b_plus_tree_concurrent_test.cpp</code></a></li></ul><p>We <strong>strongly</strong> encourage you to write additional test cases for yourself to better understand your implementation.</p><p>You can test the individual components of this assigment using our testing framework. We use <a href="https://github.com/google/googletest" target="_blank" rel="noopener noreferrer">GTest</a> for unit test cases.</p><p>You can compile and run each test individually from the command line:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make b_plus_tree_insert_test -j$(nproc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ./test/b_plus_tree_insert_test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also run <code>make check-tests</code> to run all the test cases.
Note that some tests are disabled as you have not implemented future projects.
You can disable tests in GTest by adding a <code>DISABLED_</code> prefix to the test name.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tree-visualization">Tree Visualization<a href="#tree-visualization" class="hash-link" aria-label="Direct link to Tree Visualization" title="Direct link to Tree Visualization">​</a></h2><p>BusTub includes a built-in tool ( <a href="https://github.com/cmu-db/bustub/blob/master/tools/b_plus_tree_printer/b_plus_tree_printer.cpp" target="_blank" rel="noopener noreferrer" title="View Source Code"><code>tools/b_plus_tree_printer/b_plus_tree_printer.cpp</code></a>) for generating a graphical representation of your B+Tree.
This tool will help you check your solution for correct behavior to ensure it is performing the splits and merges correctly.</p><p>To generate a dot file after constructing a tree:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ # To build the tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make b_plus_tree_printer -j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ./bin/b_plus_tree_printer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt; ... USAGE ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt; 5 5 // set leaf node and internal node max size to be 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt; f input.txt // Insert into the tree with some inserts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt; g my-tree.dot // output the tree to dot format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt; q // Quit the test (Or use another terminal)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should now have a <code>my-tree.dot</code> file with the <a href="https://en.wikipedia.org/wiki/DOT_(graph_description_language)" target="_blank" rel="noopener noreferrer">DOT</a> file format in the same directory as your test binary, which you can then visualize with a command line visualizer or an online visualizer:</p><ol><li><p>Dump the content to <a href="http://dreampuf.github.io/GraphvizOnline/" target="_blank" rel="noopener noreferrer">http://dreampuf.github.io/GraphvizOnline/</a>.</p></li><li><p>Or download a <a href="https://graphviz.org/download/" target="_blank" rel="noopener noreferrer">command line tool</a> for your platform. Then create a PNG file of your tree using this command: <code>dot -Tpng -O my-tree.dot</code></p></li></ol><p>Consider the following example generated with GraphvizOnline:</p><p><img loading="lazy" src="/assets/images/project2-tree-833aca28042dd3da86eb9eb0bdc8f029.png" width="531" height="267" class="img_ev3q"></p><ul><li><p>Rectangles in Pink represent internal nodes, those in Green represent leaf nodes.</p></li><li><p>The first row <code>P=3</code> tells you the page id of the tree page.</p></li><li><p>The second row prints out the properties.</p></li><li><p>The third row prints out keys, and pointers from internal node to the leaf node is constructed from internal node&#x27;s value.</p></li><li><p>Note that the first box of the internal node is empty. This is not a bug.</p></li></ul><p>You can also compare with our <a href="https://15445.courses.cs.cmu.edu/fall2024/bpt-printer/" target="_blank" rel="noopener noreferrer">reference solution running in your browser</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="contention-benchmark">Contention Benchmark<a href="#contention-benchmark" class="hash-link" aria-label="Direct link to Contention Benchmark" title="Direct link to Contention Benchmark">​</a></h2><p>To ensure you are implementing lock crabbing correctly, we will use a <a href="https://github.com/cmu-db/bustub/blob/master/test/storage/b_plus_tree_contention_test.cpp" target="_blank" rel="noopener noreferrer">contention benchmark</a> to collect some heuristics from your implementation, and then manually review your code based on the heuristics.
The <strong>contention ratio</strong> is the slowdown when the B+ tree is used in a multi-thread environment, compared to a single-thread environment.
The contention ratio generally should be in the range <!-- -->[<!-- -->2.5, 3.5<!-- -->]<!-- --> on Gradescope.
A contention ratio less than 2.5 probably means that your lock crabbing is incorrect (e.g, use some global locks or hold locks for an unnecessarily long time).</p><p>A contention ratio greater than 3.5 probably means that the lock contention is too high in your implementation and you are recommended to investigating what is happening.</p><p><strong>Your submission must pass contention benchmark without segfault and deadlock. Otherwise you will get zero score for all of the</strong>
<strong>concurrent test cases (which will be deducted manually).</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="formatting">Formatting<a href="#formatting" class="hash-link" aria-label="Direct link to Formatting" title="Direct link to Formatting">​</a></h2><p>Your code must follow the <a href="https://google.github.io/styleguide/cppguide.html" target="_blank" rel="noopener noreferrer">Google C++ Style Guide</a>.
We use <a href="https://clang.llvm.org/" target="_blank" rel="noopener noreferrer">Clang</a> to automatically check the quality of your source code.
Your project grade will be <strong>zero</strong> if your submission fails any of these checks.</p><p>Execute the following commands to check your syntax.
The <code>format</code> target will automatically correct your code.
The <code>check-lint</code> and <code>check-clang-tidy-p2</code> targets will print errors and instruct you how to fix it to conform to our style guide.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ make format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make check-lint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make check-clang-tidy-p2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="memory-leaks">Memory Leaks<a href="#memory-leaks" class="hash-link" aria-label="Direct link to Memory Leaks" title="Direct link to Memory Leaks">​</a></h2><p>For this project, we use <a href="https://clang.llvm.org/docs/AddressSanitizer.html" target="_blank" rel="noopener noreferrer">LLVM Address Sanitizer (ASAN) and Leak Sanitizer (LSAN)</a> to check for memory errors.
To enable ASAN and LSAN, configure CMake in debug mode and run tests as you normally would.
If there is a memory error, you will see a memory error report.
Note that MacOS <strong>only supports address sanitizer without leak sanitizer</strong>.</p><p>In some cases, address sanitizer might affect the usability of the debugger.
In this case, you might need to disable all sanitizers by configuring the CMake project with:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cmake -DCMAKE_BUILD_TYPE=Debug -DBUSTUB_SANITIZER= ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-hints">Development Hints<a href="#development-hints" class="hash-link" aria-label="Direct link to Development Hints" title="Direct link to Development Hints">​</a></h2><p>You can use <code>BUSTUB_ASSERT</code> for assertions in debug mode.
Note that the statements within <code>BUSTUB_ASSERT</code> will NOT be executed in release mode.
If you have something to assert in all cases, use <code>BUSTUB_ENSURE</code> instead.</p><p>We encourage you to use a graphical debugger to debug your project if you are having problems.</p><p>If you are having compilation problems, running <code>make clean</code> does not completely reset the compilation process.
You will need to delete your build directory and run <code>cmake ..</code> again before you rerun <code>make</code>.</p><p>Post all of your questions about this project on Piazza. Do not email the TAs directly with questions.</p><h1>Grading Rubric</h1><p>Each project submission will be graded based on the following criteria:</p><ol><li><p>Does the submission successfully execute all of the test cases and produce the correct answer?</p></li><li><p>Does the submission execute without any memory leaks?</p></li><li><p>Does the submission follow the code formatting and style policies?</p></li></ol><h1>Late Policy</h1><p>See the <a href="https://15445.courses.cs.cmu.edu/fall2024/syllabus.html#late-policy" target="_blank" rel="noopener noreferrer">late policy</a> in the syllabus.</p><h1>Submission</h1><p>After completing the assignment, you can submit your implementation to Gradescope:</p><ul><li><strong><a href="https://www.gradescope.com/courses/817456" target="_blank" rel="noopener noreferrer">https://www.gradescope.com/courses/817456</a></strong></li></ul><p>Running <code>make submit-p2</code> in your <code>build/</code> directory will generate a <code>zip</code> archive called <code>project2-submission.zip</code> under your project root directory that you can submit to Gradescope.
You can submit your zip file as many times as you want and get immediate feedback. Your score will be sent via email to your Andrew account within a few minutes after your submission.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="notes-on-gradescope-and-autograder">Notes on Gradescope and Autograder<a href="#notes-on-gradescope-and-autograder" class="hash-link" aria-label="Direct link to Notes on Gradescope and Autograder" title="Direct link to Notes on Gradescope and Autograder">​</a></h2><ol><li>If you are timing out on Gradescope, it is likely because you have a deadlock in your code or your code is too slow and does not run in 60 seconds.</li><li>The autograder will not work if you are printing too many logs in your submissions.</li><li>If the autograder did not work properly, make sure that your formatting commands work and that you are submitting the right files.</li><li>The leaderboard benchmark score will be calculated by stress testing your B+Tree implementation.</li></ol><p>CMU students should use the Gradescope course code announced on Piazza.</p><h1>Collaboration Policy</h1><ul><li>Every student has to work individually on this assignment.</li><li>Students are allowed to discuss high-level details about the project with others.</li><li>Students are <strong>not</strong> allowed to copy the contents of a white-board after a group meeting with other students.</li><li>Students are <strong>not</strong> allowed to copy the solutions from another colleague.</li></ul><p><strong>WARNING:</strong> All of the code for this project must be your own. You may not copy source code from other students or other sources that you find on the web. Plagiarism <strong>will not</strong> be tolerated. See CMU&#x27;s <a href="https://www.cmu.edu/policies/student-and-student-life/academic-integrity.html" target="_blank" rel="noopener noreferrer">Policy on Academic Integrity</a> for additional information.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/curriculum-resource/15-445/project/project02"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Project 01</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/curriculum-resource/15-445/project/project04"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Project 03</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#task-1---btree-pages" class="table-of-contents__link toc-highlight">Task #1 - B+Tree Pages</a><ul><li><a href="#base-page" class="table-of-contents__link toc-highlight">Base Page</a></li><li><a href="#internal-page" class="table-of-contents__link toc-highlight">Internal Page</a></li><li><a href="#leaf-page" class="table-of-contents__link toc-highlight">Leaf Page</a></li></ul></li><li><a href="#task-2---btree-operations-insertion-deletion-and-point-search" class="table-of-contents__link toc-highlight">Task #2 - B+Tree Operations (Insertion, Deletion, and Point Search)</a></li><li><a href="#task-3---index-iterator" class="table-of-contents__link toc-highlight">Task #3 - Index Iterator</a></li><li><a href="#task-4---concurrency-control" class="table-of-contents__link toc-highlight">Task #4 - Concurrency Control</a></li><li><a href="#leaderboard-task-optional" class="table-of-contents__link toc-highlight">Leaderboard Task (Optional)</a></li><li><a href="#development-roadmap" class="table-of-contents__link toc-highlight">Development Roadmap</a></li><li><a href="#requirements-and-hints" class="table-of-contents__link toc-highlight">Requirements and Hints</a></li><li><a href="#common-pitfalls" class="table-of-contents__link toc-highlight">Common Pitfalls</a></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a></li><li><a href="#tree-visualization" class="table-of-contents__link toc-highlight">Tree Visualization</a></li><li><a href="#contention-benchmark" class="table-of-contents__link toc-highlight">Contention Benchmark</a></li><li><a href="#formatting" class="table-of-contents__link toc-highlight">Formatting</a></li><li><a href="#memory-leaks" class="table-of-contents__link toc-highlight">Memory Leaks</a></li><li><a href="#development-hints" class="table-of-contents__link toc-highlight">Development Hints</a></li><li><a href="#notes-on-gradescope-and-autograder" class="table-of-contents__link toc-highlight">Notes on Gradescope and Autograder</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">CS学习社区</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">路线图</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/WqwvTrEQmA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">捐赠</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/donate">捐赠我们</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyleft © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.30603f7d.js"></script>
<script src="/assets/js/main.b37f8dfa.js"></script>
</body>
</html>