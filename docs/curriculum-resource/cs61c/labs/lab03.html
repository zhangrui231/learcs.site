<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-curriculum-resource/cs61c/labs/lab03" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Lab03 | CS自学社区</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.learncs.site/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.learncs.site/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.learncs.site/docs/curriculum-resource/cs61c/labs/lab03"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab03 | CS自学社区"><meta data-rh="true" name="description" content="Before you begin"><meta data-rh="true" property="og:description" content="Before you begin"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.learncs.site/docs/curriculum-resource/cs61c/labs/lab03"><link data-rh="true" rel="alternate" href="https://www.learncs.site/docs/curriculum-resource/cs61c/labs/lab03" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.learncs.site/docs/curriculum-resource/cs61c/labs/lab03" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CS自学社区 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CS自学社区 Atom Feed">



<link rel="preconnect" href="https://hm.baidu.com">
<script async src="https://hm.baidu.com/hm.js?c106b2729592653e5e0c26db5e5d3142"></script>
<script src="https://sf-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/0.1.0-beta.4/libs/oversea/index.js"></script>
<script>document.addEventListener("DOMContentLoaded",(function(){console.log("DOMContentLoaded coze"),new CozeWebSDK.WebChatClient({config:{bot_id:"7380921096788590598"},componentProps:{title:"AI 助教"}})}))</script><link rel="stylesheet" href="/assets/css/styles.0cbaf963.css">
<link rel="preload" href="/assets/js/runtime~main.e4490b66.js" as="script">
<link rel="preload" href="/assets/js/main.af5e7644.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="TeachYourselfCS" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="TeachYourselfCS" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">TeachYourselfCS</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">自学路线</a><a class="navbar__item navbar__link" href="/blog">博客</a><a class="navbar__item navbar__link" href="/community">社区</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">前言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/roadmap">路线图</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/课程资源">课程资源</a><button aria-label="Toggle the collapsible sidebar category &#x27;课程资源&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs50x">cs50x</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs50x&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs61a">cs61a</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs61a&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs61b">cs61b</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs61b&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/curriculum-resource/cs61c">cs61c</a><button aria-label="Toggle the collapsible sidebar category &#x27;cs61c&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/syllabus">syllabus-课程大纲</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab00">labs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab00">Lab0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab01">Lab01</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab02">Lab02</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab03">Lab03</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab04">Lab04</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab05">Lab05</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab06">Lab06</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab07">Lab07</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab08">Lab08</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab09">Lab09</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab10">Lab10</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/curriculum-resource/cs61c/labs/lab11">Lab11</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/curriculum-resource/cs61c/projects/proj1">projects</a></div></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/课程资源"><span itemprop="name">课程资源</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/curriculum-resource/cs61c"><span itemprop="name">cs61c</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">labs</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab03</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 3</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="before-you-begin">Before you begin<a href="#before-you-begin" class="hash-link" aria-label="Direct link to Before you begin" title="Direct link to Before you begin">​</a></h2><p>This lab is somewhat longer than the previous labs (and longer than most future labs as well). This is in order to give everyone a chance to get comfortable with writing RISC-V and using the Venus simulator before the release of project 2, which will require you to write a fair amount of assembly.</p><p>To this end, we recommend that you watch this week’s lectures and get started on this assignment as early as possible. Good luck! If you have any questions or run into any issues, then please feel free to ask in office hours or on Piazza.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="goals">Goals<a href="#goals" class="hash-link" aria-label="Direct link to Goals" title="Direct link to Goals">​</a></h2><ul><li>Practice running and debugging RISC-V assembly code.</li><li>Write RISC-V functions with the correct function calling procedure.</li><li>Get an idea of how to translate C code to RISC-V.</li><li>Get familiar with using the Venus simulator</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-the-files">Getting the files<a href="#getting-the-files" class="hash-link" aria-label="Direct link to Getting the files" title="Direct link to Getting the files">​</a></h2><p>To get the starter files for this lab, run the following command in your <code>labs</code> directory.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ git pull starter master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you get an error like the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fatal: &#x27;starter&#x27; does not appear to be a git repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fatal: Could not read from remote repository.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>make sure to set the starter remote as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git remote add starter https://github.com/61c-teach/fa20-lab-starter.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and run the original command again.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro-to-assembly-with-risc-v-simulator">Intro to Assembly with RISC-V Simulator<a href="#intro-to-assembly-with-risc-v-simulator" class="hash-link" aria-label="Direct link to Intro to Assembly with RISC-V Simulator" title="Direct link to Intro to Assembly with RISC-V Simulator">​</a></h2><p>In this course, we have so far dealt mostly with C programs (with the <code>.c</code> file extension), used the <code>gcc</code> program to compile them to machine code, and then executed them directly on your computer or hive machine. Now, we’re shifting our focus to the RISC-V assembly language, which is a lower-level language much closer to machine code. We can’t execute RISC-V code directly because your computer and the hives are built to run machine code from other assembly languages - most likely x86 or ARM.</p><p>In this lab, we will deal with several RISC-V assembly program files, each of which have a <code>.s</code> file extension. To run these, we will need to use <strong>Venus</strong>, a RISC-V simulator that you can find <a href="https://web.archive.org/web/20230126061759/https://venus.cs61c.org/" target="_blank" rel="noopener noreferrer">here</a>. There is also a <code>.jar</code> version of Venus that we have provided in the <code>tools</code> folder under your base lab repository.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="assemblyvenus-basics">Assembly/Venus Basics<a href="#assemblyvenus-basics" class="hash-link" aria-label="Direct link to Assembly/Venus Basics" title="Direct link to Assembly/Venus Basics">​</a></h3><p>To get started with Venus, please take a look at “The Editor Tab” and “The Simulator Tab” in the <a href="https://web.archive.org/web/20230126061759/https://inst.eecs.berkeley.edu/~cs61c/sp21/resources/venus-reference" target="_blank" rel="noopener noreferrer">Venus reference</a>. We recommend that you read this whole page at some point, but these sections should be enough to get started.</p><p><strong>For the following exercises, please make sure your completed code is saved on a file on your local machine. Otherwise, we will have no proof that you completed the lab exercises.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-0-connecting-your-files-to-venus">Exercise 0: Connecting your files to Venus<a href="#exercise-0-connecting-your-files-to-venus" class="hash-link" aria-label="Direct link to Exercise 0: Connecting your files to Venus" title="Direct link to Exercise 0: Connecting your files to Venus">​</a></h2><p>In previous iterations of the course, the Venus web editor allows you to write assembly code from scratch or to manually upload and download files, but thanks to a recent update, you can now “mount” a folder from your local device onto Venus’s web frontend! This means that any changes you make in Venus’s editor will be reflected in your local files, and vice versa.</p><p>This exercise will walk you through the process of connecting your file system to Venus, which should save you a lot of trouble copy/pasting files between your local drive and the Venus editor.</p><p><strong>If for some reason this feature ends up not working for you</strong> (it’s relatively new, and there’s a chance there might still be bugs), then for the rest of this assignment, wherever it says to open a file in Venus, you should copy/paste the contents into the Venus web editor, and manually copy/paste those changes back to your local machine.</p><p>Here’s what you need to do:</p><ul><li>In the labs folder on your local machine, run <code>java -jar tools/venus.jar . -dm</code>. This will expose your lab directory to Venus on a network port (6161 by default).<ul><li>You should see the message <code>To connect, enter `mount http://localhost:6161 vmfs` on Venus.</code>, as well as a a big “Javalin” logo.</li><li>If you see a message along the lines of “port unable to be bound”, then you can specify the port number explicitly by appending <code>--port &lt;port number&gt;</code> to the command (for example, <code>java -jar tools/venus.jar . -dm --port 6162</code> will expose the file system on port 6162)</li></ul></li><li>Open <a href="https://venus.cs61c.org" target="_blank" rel="noopener noreferrer">https://venus.cs61c.org</a> in your web browser. In the Venus terminal, run <code>mount local vmfs</code> (if you chose a different port, replace “local” with the full URL, such as <code>http://localhost:6162</code>). This connects Venus to your file system.</li><li>Go to the “Files” tab. You should now be able to see your labs directory under the <code>vmfs</code> folder.</li><li>Navigate to <code>lab03</code>, and make sure it works by hitting the <code>Edit</code> button next to <code>ex1.s</code>. This should open in the <code>Editor</code> tab.<ul><li>If you make any changes to the file in the <code>Editor</code> tab, hitting command-s on a Mac and ctrl-s on Windows/Linux will update your local copy of the file. To check if the save was successful, open the file on your local machine to see if it matches what you have in the web editor (unfortunately no feedback message has been implemented yet).</li><li><strong>Note:</strong> If you make any changes to a file in your local machine, if you had the same file open in the Venus editor, you’ll need to reopen it from the “Files” menu to get the new changes.</li></ul></li><li>To make it so that the file system will attempt to remount automatically whenever you close and reopen Venus, enable “Save on Close” in the Settings pane (again in the Venus tab). This will make the Venus web client attempt to locate the file system exposed by running the Venus jar, and will pop up an error saying that it couldn’t connect to the server if it doesn’t see it running. If this happens, just follow the above steps to manually remount the file system.</li></ul><p>Once you’ve got <code>ex1.s</code> open, you’re ready to move on to Exercise 1!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-1-familiarizing-yourself-with-venus">Exercise 1: Familiarizing yourself with Venus<a href="#exercise-1-familiarizing-yourself-with-venus" class="hash-link" aria-label="Direct link to Exercise 1: Familiarizing yourself with Venus" title="Direct link to Exercise 1: Familiarizing yourself with Venus">​</a></h2><p>Getting started:</p><ol><li>Open <code>ex1.s</code> into the Venus editor. If you were unable to mount the filesystem in Exercise 0, then you can copy/paste <code>ex1.s</code> from your local machine into the Venus editor directly.</li><li>Click the “Simulator” tab and click the “Assemble &amp; Simulate from Editor” button. This will prepare the code you wrote for execution. If you click back to the “Editor” tab, your simulation will be reset.</li><li>In the simulator, to execute the next instruction, click the “step” button.</li><li>To undo an instruction, click the “prev” button. Note that undo may or may not undo operations performed by <code>ecall</code>, such as exiting the program or printing to console.</li><li>To run the program to completion, click the “run” button.</li><li>To reset the program from the start, click the “reset” button.</li><li>The contents of all 32 registers are on the right-hand side, and the console output is at the bottom.</li><li>To view the contents of memory, click the “Memory” tab on the right. You can navigate to different portions of your memory using the dropdown menu at the bottom.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="action-item">Action Item<a href="#action-item" class="hash-link" aria-label="Direct link to Action Item" title="Direct link to Action Item">​</a></h3><p>Open <code>ex1.s</code> in Venus and record your answers to the following questions. Some of the questions will require you to run the RISC-V code using Venus’s simulator tab.</p><ol><li>What do the <code>.data</code>, <code>.word</code>, <code>.text</code> directives mean (i.e. what do you use them for)? <strong>Hint</strong>: think about the 4 sections of memory.</li><li>Run the program to completion. What number did the program output? What does this number represent?</li><li>At what address is <code>n</code> stored in memory? <strong>Hint</strong>: Look at the contents of the registers.</li><li>Without actually editing the code (i.e. without going into the “Editor” tab), have the program calculate the 13th fib number (0-indexed) by <em>manually</em> modifying the value of a register. You may find it helpful to first step through the code. If you prefer to look at decimal values, change the “Display Settings” option at the bottom.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-2-translating-from-c-to-risc-v">Exercise 2: Translating from C to RISC-V<a href="#exercise-2-translating-from-c-to-risc-v" class="hash-link" aria-label="Direct link to Exercise 2: Translating from C to RISC-V" title="Direct link to Exercise 2: Translating from C to RISC-V">​</a></h2><p>Open the files <code>ex2.c</code> and <code>ex2.s</code>. The assembly code provided (.s file) is a translation of the given C program into RISC-V.</p><p>In addition to opening a file in the “Editor” tab and then running in the “Simulator” tab as described above, you can also run <code>ex2.s</code> directly within the Venus terminal by <code>cd</code>ing into the appropriate folder, then running <code>run ex2.s</code> or <code>./ex2.s</code>. Typing <code>vdb ex2.s</code> will also assemble the file and take you to the “Simulator” tab directly.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="action-item-1">Action Item<a href="#action-item-1" class="hash-link" aria-label="Direct link to Action Item" title="Direct link to Action Item">​</a></h3><p>Find/explain the following components of this assembly file.</p><ul><li>The register representing the variable <code>k</code>.</li><li>The register representing the variable <code>sum</code>.</li><li>The registers acting as pointers to the <code>source</code> and <code>dest</code> arrays.</li><li>The assembly code for the loop found in the C code.</li><li>How the pointers are manipulated in the assembly code.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-3-factorial">Exercise 3: Factorial<a href="#exercise-3-factorial" class="hash-link" aria-label="Direct link to Exercise 3: Factorial" title="Direct link to Exercise 3: Factorial">​</a></h2><p>In this exercise, you will be implementing the <code>factorial</code> function in RISC-V. This function takes in a single integer parameter <code>n</code> and returns <code>n!</code>. A stub of this function can be found in the file <code>factorial.s</code>.</p><p>You will only need to add instructions under the <code>factorial</code> label, and the argument that is passed into the function is configured to be located at the label <code>n</code>. You may solve this problem using either recursion or iteration. You may also assume that the <code>factorial</code> function will only be called on positive values with results that won’t overflow a 32-bit two’s complement integer.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h3><p>As a sanity check, you should make sure your function properly returns that <code>3! = 6</code>, <code>7! = 5040</code> and <code>8! = 40320</code>.</p><p>You have the option to test this using the online version of Venus, but we’ve provided a <code>.jar</code> for you to test locally! We’ll be using the <code>.jar</code> in the autograder so make sure to update your <code>factorial.s</code> file and run the following command before you submit to verify that the output is correct. Note that you will need to have java installed to run this command.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ java -jar tools/venus.jar lab03/factorial.s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-4-calling-convention-checker">Exercise 4: Calling Convention Checker<a href="#exercise-4-calling-convention-checker" class="hash-link" aria-label="Direct link to Exercise 4: Calling Convention Checker" title="Direct link to Exercise 4: Calling Convention Checker">​</a></h2><p>In this exercise, we’ll be looking at the code in <code>cc_test.s</code>. We’ll be using a feature that’s only available on the command line version of Venus, so if you’re still using the Venus web editor, make sure you hit cmd-s or ctrl-s to make sure your changes are reflected in your local files. Likewise, if you modify your local files and want to use the Venus web simulator, make sure to reopen your file through the simulator to make sure the changes are reflected.</p><p>Throughout this course, we will be running automated checks to make sure your assembly complies with RISC-V calling conventions, as described in lecture and discussion. Here’s a quick recap: all functions that overwrite registers that are preserved by convention must have a prologue, which saves those register values to the stack at the start of the function, and an epilogue, which restores those values for the function’s caller. You can find a more detailed explanation along with some concrete examples in <a target="_blank" href="/assets/files/RISCV_Calling_Convention-fb38c62ecbe1cc07ab5b25522d6192e4.pdf">these notes</a>.</p><p>Bugs due to calling convention violations can often be difficult to find manually, so Venus provides a way to automatically report some of these errors at runtime.</p><p>Take a look at the contents of the <code>cc_test.s</code> file, particularly at the <code>main</code>, <code>simple_fn</code>, <code>naive_pow</code>, <code>inc_arr</code>, and <code>helper_fn</code> functions. Now, run Venus locally with the following command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ java -jar tools/venus.jar -cc lab03/cc_test.s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong> The <code>-cc</code> flag <strong>MUST</strong> go between <code>tool/venus.jar</code> and the file you’re running. If it goes before <code>venus.jar</code> it will be treated as an argument to the <code>java</code> program; if it goes after the file name it will treated as an argument to the <code>main</code> function of your assembly program.</p><p>The <code>-cc</code> flag enables the calling convention checker, and detects some basic violations. You should see an output similar to the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x00000080) Usage of unset register t0! main.S:58 mv a0, t0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x0000008C) Setting of a saved register (s0) which has not been saved! main.S:80 li s0, 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x00000094) Setting of a saved register (s0) which has not been saved! main.S:83 mul s0, s0, a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x00000094) Setting of a saved register (s0) which has not been saved! main.S:83 mul s0, s0, a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x00000094) Setting of a saved register (s0) which has not been saved! main.S:83 mul s0, s0, a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x00000094) Setting of a saved register (s0) which has not been saved! main.S:83 mul s0, s0, a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x00000094) Setting of a saved register (s0) which has not been saved! main.S:83 mul s0, s0, a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x00000094) Setting of a saved register (s0) which has not been saved! main.S:83 mul s0, s0, a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x00000094) Setting of a saved register (s0) which has not been saved! main.S:83 mul s0, s0, a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x000000A4) Save register s0 not correctly restored before return! Expected 0x00000A3F, Actual 0x00000080. main.S:90 ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x000000B0) Setting of a saved register (s0) which has not been saved! main.S:106 mv s0, a0 # Copy start of array to saved register</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x000000B4) Setting of a saved register (s1) which has not been saved! main.S:107 mv s1, a1 # Copy length of array to saved register</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CC Violation]: (PC=0x000000E4) Setting of a saved register (s0) which has not been saved! main.S:142 addi s0, t1, 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Venus ran into a simulator error!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Attempting to access uninitialized memory between the stack and heap. Attempting to access &#x27;4&#x27; bytes at address &#x27;347579389&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Find the source of each of the errors reported by the CC checker and fix it. Even though the output says <code>main.S</code>, the line number reported should still correspond to the correct line in <code>cc_test.s</code>: this is just an artifact of the way Venus works in order to support combining multiple assembly files together. You can find a list of CC error messages, as well as their meanings, in the <a href="https://web.archive.org/web/20230126061759/https://inst.eecs.berkeley.edu/~cs61c/sp21/resources/venus-reference#calling-convention-checker" target="_blank" rel="noopener noreferrer">Venus reference</a>.</p><p>Once you’ve fixed all the violations reported by the CC checker, the code might still fail: this is likely because there’s still some remaining calling convention errors that Venus doesn’t report. Since function calls in assembly language are ultimately just jumps, Venus can’t report these violations without more information, at risk of producing false positives.</p><p>The fixes for all of these errors (both the ones reported by the CC checker and the ones it can’t find) should be added near the lines marked by the <code>FIXME</code> comments in the starter code.</p><p><strong>Note:</strong> Venus’s calling convention checker will not report all calling convention bugs; it is intended to be used primarily as a sanity check. Most importantly, it will only look for bugs in functions that are exported with the <code>.globl</code> directive - the meaning of <code>.globl</code> is explained in more detail in the <a href="https://web.archive.org/web/20230126061759/https://inst.eecs.berkeley.edu/~cs61c/sp21/resources/venus-reference#working-with-multiple-files" target="_blank" rel="noopener noreferrer">Venus reference</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="action-item-2">Action Item<a href="#action-item-2" class="hash-link" aria-label="Direct link to Action Item" title="Direct link to Action Item">​</a></h3><p>Resolve all the calling convention errors in <code>cc_test.s</code>, and be able to answer the following questions:</p><ul><li>What caused the errors in <code>simple_fn</code>, <code>naive_pow</code>, and <code>inc_arr</code> that were reported by the Venus CC checker?</li><li>In RISC-V, we call functions by jumping to them and storing the return address in the <code>ra</code> register. Does calling convention apply to the jumps to the <code>naive_pow_loop</code> or <code>naive_pow_end</code> labels?</li><li>Why do we need to store <code>ra</code> in the prologue for <code>inc_arr</code>, but not in any other function?</li><li>Why wasn’t the calling convention error in <code>helper_fn</code> reported by the CC checker? (Hint: it’s mentioned above in the exercise instructions.)</li></ul><p>Once you have answered these, run Venus with the calling convention checker on <code>factorial.s</code> from the last exercise as well. Make sure to fix any bugs you find.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-1">Testing<a href="#testing-1" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h3><p>After fixing the errors in <code>cc_test.s</code>, run Venus locally with the above command to make sure the behavior of the functions hasn’t changed and that you’ve remedied all calling convention violations.</p><p>Once you have fixed everything, running the above Venus command should output the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Sanity checks passed! Make sure there are no CC violations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found 0 warnings!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-5-risc-v-function-calling-with-map">Exercise 5: RISC-V function calling with <code>map</code><a href="#exercise-5-risc-v-function-calling-with-map" class="hash-link" aria-label="Direct link to exercise-5-risc-v-function-calling-with-map" title="Direct link to exercise-5-risc-v-function-calling-with-map">​</a></h2><p>This exercise uses the file <code>list_map.s</code>.</p><p>In this exercise, you will complete an implementation of <a href="https://web.archive.org/web/20230126061759/https://en.wikipedia.org/wiki/Map_(higher-order_function)" target="_blank" rel="noopener noreferrer"><code>map</code></a> on linked-lists in RISC-V. Our function will be simplified to mutate the list in-place, rather than creating and returning a new list with the modified values.</p><p>You will find it helpful to refer to the <a target="_blank" href="/assets/files/riscvcard-75f9fb3a791fab6eee17d3cf216f77f0.pdf">RISC-V green card</a> to complete this exercise. If you encounter any instructions or pseudo-instructions you are unfamiliar with, use this as a resource.</p><p>Our <code>map</code> procedure will take two parameters; the first parameter will be the address of the head node of a singly-linked list whose values are 32-bit integers. So, in C, the structure would be defined as:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct node {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct node *next;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Our second parameter will be the <strong>address of a function</strong> that takes one int as an argument and returns an int. We’ll use the <code>jalr</code> RISC-V instruction to call this function on the list node values.</p><p>Our <code>map</code> function will recursively go down the list, applying the function to each value of the list and storing the value returned in that corresponding node. In C, the function would be something like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void map(struct node *head, int (*f)(int))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!head) { return; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    head-&gt;value = f(head-&gt;value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    map(head-&gt;next,f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you haven’t seen the <code>int (*f)(int)</code> kind of declaration before, don’t worry too much about it. Basically it means that <code>f</code> is a pointer to a function, which, in C, can then be used exactly like any other function.</p><p>There are exactly nine (9) markers (8 in <code>map</code> and 1 in <code>main</code>) in the provided code where it says <code>YOUR CODE HERE</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="action-item-3">Action Item<a href="#action-item-3" class="hash-link" aria-label="Direct link to Action Item" title="Direct link to Action Item">​</a></h3><p>Complete the implementation of <code>map</code> by filling out each of these nine markers with the appropriate code. Furthermore, provide a sample call to <code>map</code> with <code>square</code> as the function argument. There are comments in the code that explain what should be accomplished at each marker. When you’ve filled in these instructions, running the code should provide you with the following output:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">9 8 7 6 5 4 3 2 1 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">81 64 49 36 25 16 9 4 1 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first line is the original list, and the second line is the modified list after the map function (in this case square) is applied.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-2">Testing<a href="#testing-2" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h3><p>To test this in the Venus web simulator, run <code>list_map.s</code> and examine the output. To test this locally, run the following command in your root lab directory (much like the one for <code>factorial.s</code>):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ java -jar tools/venus.jar lab03/list_map.s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transitioning-to-more-complex-risc-v-programs">Transitioning to More Complex RISC-V Programs<a href="#transitioning-to-more-complex-risc-v-programs" class="hash-link" aria-label="Direct link to Transitioning to More Complex RISC-V Programs" title="Direct link to Transitioning to More Complex RISC-V Programs">​</a></h2><p>In the future, we’ll be working with more complex RISC-V programs that require multiple files of assembly code. To prepare for this, we recommend looking over the following sections of the Venus reference:</p><ul><li><a href="https://web.archive.org/web/20230126061759/https://inst.eecs.berkeley.edu/~cs61c/sp21/resources/venus-reference#writing-larger-risc-v-programs" target="_blank" rel="noopener noreferrer">Writing Larger RISC-V Programs</a></li><li><a href="https://web.archive.org/web/20230126061759/https://inst.eecs.berkeley.edu/~cs61c/sp21/resources/venus-reference#the-venus-tab" target="_blank" rel="noopener noreferrer">Using the Web Terminal</a></li><li><a href="https://web.archive.org/web/20230126061759/https://inst.eecs.berkeley.edu/~cs61c/sp21/resources/venus-reference#the-venus-tab" target="_blank" rel="noopener noreferrer">Passing Command Line Arguments</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="checkoff">Checkoff<a href="#checkoff" class="hash-link" aria-label="Direct link to Checkoff" title="Direct link to Checkoff">​</a></h2><p>Please submit to the Lab Autograder assignment (same as last week!).</p><p>Checkoff questions for lab 3:</p><ul><li>Make sure you understand and can answer the questions in exercises 1, 2, and 4!</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/curriculum-resource/cs61c/labs/lab02"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab02</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/curriculum-resource/cs61c/labs/lab04"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab04</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#before-you-begin" class="table-of-contents__link toc-highlight">Before you begin</a></li><li><a href="#goals" class="table-of-contents__link toc-highlight">Goals</a></li><li><a href="#getting-the-files" class="table-of-contents__link toc-highlight">Getting the files</a></li><li><a href="#intro-to-assembly-with-risc-v-simulator" class="table-of-contents__link toc-highlight">Intro to Assembly with RISC-V Simulator</a><ul><li><a href="#assemblyvenus-basics" class="table-of-contents__link toc-highlight">Assembly/Venus Basics</a></li></ul></li><li><a href="#exercise-0-connecting-your-files-to-venus" class="table-of-contents__link toc-highlight">Exercise 0: Connecting your files to Venus</a></li><li><a href="#exercise-1-familiarizing-yourself-with-venus" class="table-of-contents__link toc-highlight">Exercise 1: Familiarizing yourself with Venus</a><ul><li><a href="#action-item" class="table-of-contents__link toc-highlight">Action Item</a></li></ul></li><li><a href="#exercise-2-translating-from-c-to-risc-v" class="table-of-contents__link toc-highlight">Exercise 2: Translating from C to RISC-V</a><ul><li><a href="#action-item-1" class="table-of-contents__link toc-highlight">Action Item</a></li></ul></li><li><a href="#exercise-3-factorial" class="table-of-contents__link toc-highlight">Exercise 3: Factorial</a><ul><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a></li></ul></li><li><a href="#exercise-4-calling-convention-checker" class="table-of-contents__link toc-highlight">Exercise 4: Calling Convention Checker</a><ul><li><a href="#action-item-2" class="table-of-contents__link toc-highlight">Action Item</a></li><li><a href="#testing-1" class="table-of-contents__link toc-highlight">Testing</a></li></ul></li><li><a href="#exercise-5-risc-v-function-calling-with-map" class="table-of-contents__link toc-highlight">Exercise 5: RISC-V function calling with <code>map</code></a><ul><li><a href="#action-item-3" class="table-of-contents__link toc-highlight">Action Item</a></li><li><a href="#testing-2" class="table-of-contents__link toc-highlight">Testing</a></li></ul></li><li><a href="#transitioning-to-more-complex-risc-v-programs" class="table-of-contents__link toc-highlight">Transitioning to More Complex RISC-V Programs</a></li><li><a href="#checkoff" class="table-of-contents__link toc-highlight">Checkoff</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">CS学习社区</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">路线图</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e4490b66.js"></script>
<script src="/assets/js/main.af5e7644.js"></script>
</body>
</html>