"use strict";(self.webpackChunklearncs_set=self.webpackChunklearncs_set||[]).push([[5197],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),d=a,h=p["".concat(s,".").concat(d)]||p[d]||m[d]||i;return n?r.createElement(h,o(o({ref:t},u),{},{components:n})):r.createElement(h,o({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},68585:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const i={},o="CS 61C",l={unversionedId:"curriculum-resource/cs61c/labs/lab04",id:"curriculum-resource/cs61c/labs/lab04",title:"CS 61C",description:"Deadline: End of Lab Friday, September 25.",source:"@site/docs/curriculum-resource/cs61c/labs/lab04.md",sourceDirName:"curriculum-resource/cs61c/labs",slug:"/curriculum-resource/cs61c/labs/lab04",permalink:"/docs/curriculum-resource/cs61c/labs/lab04",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"CS 61C",permalink:"/docs/curriculum-resource/cs61c/labs/lab03"},next:{title:"CS 61C",permalink:"/docs/curriculum-resource/cs61c/labs/lab05"}},s={},c=[{value:"Objectives",id:"objectives",level:2},{value:"RISC-V Simulator",id:"risc-v-simulator",level:2},{value:"Exercise 1: Debugging <code>megalistmanips.s</code>",id:"exercise-1-debugging-megalistmanipss",level:2},{value:"Action Item",id:"action-item",level:3},{value:"Checkpoint",id:"checkpoint",level:3},{value:"Exercise 2: Write a function without branches",id:"exercise-2-write-a-function-without-branches",level:2},{value:"Action Item",id:"action-item-1",level:3},{value:"Checkoff",id:"checkoff",level:2}],u={toc:c},p="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"cs-61c"},"CS 61C"),(0,a.kt)("p",null,"Deadline: End of Lab Friday, September 25."),(0,a.kt)("h2",{id:"objectives"},"Objectives"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"TSWBAT practice debugging RISC-V assembly code."),(0,a.kt)("li",{parentName:"ul"},"TSWBAT write RISC-V functions that use pointers.")),(0,a.kt)("h2",{id:"risc-v-simulator"},"RISC-V Simulator"),(0,a.kt)("p",null,"Like last week, we will be using the ",(0,a.kt)("strong",{parentName:"p"},"Venus RISC-V simulator")," (which can be found online ",(0,a.kt)("a",{parentName:"p",href:"https://web.archive.org/web/20220121174546/https://venus.cs61c.org/"},"here"),"). Also, please refer to the ",(0,a.kt)("a",{parentName:"p",href:"https://web.archive.org/web/20220121174546/https://inst.eecs.berkeley.edu/~cs61c/sp21/resources/venus-reference"},"Venus Guide")," on our course website when you need a refresher on any of the Venus features."),(0,a.kt)("h2",{id:"exercise-1-debugging-megalistmanipss"},"Exercise 1: Debugging ",(0,a.kt)("inlineCode",{parentName:"h2"},"megalistmanips.s")),(0,a.kt)("p",null,"In Lab 3, you completed a RISC-V procedure that applied a function to every element of a linked list. In this lab, you will be working with a similar (but slightly more complex) version of that procedure."),(0,a.kt)("p",null,"Now, instead of having a linked list of ",(0,a.kt)("inlineCode",{parentName:"p"},"int"),"\u2019s, our data structure is a linked list of ",(0,a.kt)("inlineCode",{parentName:"p"},"int")," arrays. Remember that when dealing with arrays in ",(0,a.kt)("inlineCode",{parentName:"p"},"struct"),"\u2019s, we need to explicitly store the size of the array. In C code, here\u2019s what the data structure looks like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"struct node {\n    int *arr;\n    int size;\n    struct node *next;\n};\n\n")),(0,a.kt)("p",null,"Also, here\u2019s what the new ",(0,a.kt)("inlineCode",{parentName:"p"},"map")," function does: it traverses the linked list and for each element in each array of each ",(0,a.kt)("inlineCode",{parentName:"p"},"node"),", it applies the passed-in function to it, and stores it back into the array."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"void map(struct node *head, int (*f)(int)) {\n    if (!head) { return; }\n    for (int i = 0; i < head->size; i++) {\n      head->arr[i] = f(head->arr[i]);\n    }\n    map(head->next, f);\n}\n\n")),(0,a.kt)("p",null,"For the purpose of this lab, don\u2019t worry too much about the weird syntax for C function pointers (you are welcome to learn more about them ",(0,a.kt)("a",{parentName:"p",href:"https://web.archive.org/web/20220121174546/https://www.geeksforgeeks.org/function-pointer-in-c/"},"here"),"). Basically, you can pass arguments into function pointers just like you do with normal functions."),(0,a.kt)("h3",{id:"action-item"},"Action Item"),(0,a.kt)("p",null,"Record your answers to the following questions in a text file. Some of the questions will require you to run the RISC-V code using Venus\u2019 simulator tab."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Find the five mistakes inside the map function in ",(0,a.kt)("inlineCode",{parentName:"p"},"megalistmanips.s"),". Read all of the commented lines under the ",(0,a.kt)("inlineCode",{parentName:"p"},"map")," function in ",(0,a.kt)("inlineCode",{parentName:"p"},"megalistmanips.s")," (before it returns with jr ra), and ",(0,a.kt)("strong",{parentName:"p"},"make sure that the lines do what the comments say"),". Some hints:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Why do we need to save stuff on the stack before we call ",(0,a.kt)("inlineCode",{parentName:"li"},"jal"),"?"),(0,a.kt)("li",{parentName:"ul"},"What\u2019s the difference between ",(0,a.kt)("inlineCode",{parentName:"li"},"add t0, s0, x0")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"lw t0, 0(s0)"),"?"),(0,a.kt)("li",{parentName:"ul"},"Pay attention to the types of attributes in a ",(0,a.kt)("inlineCode",{parentName:"li"},"struct node"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Note"),": you need only focus on the ",(0,a.kt)("inlineCode",{parentName:"li"},"map"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"mapLoop"),", and ",(0,a.kt)("inlineCode",{parentName:"li"},"done")," functions but it\u2019s worth understanding the full program."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"For this exercise, we are requiring that you don\u2019t use any extra save registers in your implementation"),". While you normally can use the save registers to store values that you want to use after returning from a function (in this case, when we\u2019re calling ",(0,a.kt)("inlineCode",{parentName:"p"},"f")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"map"),"), we want you to use temporary registers instead and follow their caller/callee conventions. ",(0,a.kt)("strong",{parentName:"p"},"The provided ",(0,a.kt)("inlineCode",{parentName:"strong"},"map")," implementation only uses the ",(0,a.kt)("inlineCode",{parentName:"strong"},"s0")," and ",(0,a.kt)("inlineCode",{parentName:"strong"},"s1")," registers, so we\u2019ll require that you don\u2019t use ",(0,a.kt)("inlineCode",{parentName:"strong"},"s2"),"-",(0,a.kt)("inlineCode",{parentName:"strong"},"s11"),"."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Make an ordered list of each of the five mistakes, and the corrections you made to fix them"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Save your corrected code in the ",(0,a.kt)("inlineCode",{parentName:"p"},"megalistmanips.s")," file. ",(0,a.kt)("strong",{parentName:"p"},"Use the ",(0,a.kt)("inlineCode",{parentName:"strong"},"-cc")," flag to run a basic calling convention check on your code locally"),":"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"java -jar venus.jar megalistmanips.s -cc // Append appropriate path to `venus.jar` \n\n")),(0,a.kt)("p",{parentName:"li"},"The CC checker should report 0 warnings."),(0,a.kt)("p",{parentName:"li"},"Again, the ",(0,a.kt)("a",{parentName:"p",href:"https://web.archive.org/web/20220121174546/https://inst.eecs.berkeley.edu/~cs61c/sp21/resources/venus-reference"},"Venus Guide")," is a great resource if you feel unsure about any of the Venus features."),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Note"),": The CC checker won\u2019t check if you are using registers besides ",(0,a.kt)("inlineCode",{parentName:"p"},"s0")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"s1"),", but you need to implement this requirement in order to pass the autograder.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"For reference, running ",(0,a.kt)("inlineCode",{parentName:"p"},"megalistmanips")," on the web interface should give the following output:"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Lists before:\n5 2 7 8 1\n1 6 3 8 4\n5 2 7 4 3\n1 2 3 4 7\n5 6 7 8 9\n\nLists after:\n30 6 56 72 2\n2 42 12 72 20\n30 6 56 20 12\n2 6 12 20 56\n30 42 56 72 90\n\n")),(0,a.kt)("h3",{id:"checkpoint"},"Checkpoint"),(0,a.kt)("p",null,"At this point, make sure that you are comfortable with the following. Note that these will not be part of the lab checkoff, but are meant to benchmark how comfortable you are with the material in the exercise."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"You should know how to debug in Venus, including stepping through code and inspecting the contents of registers."),(0,a.kt)("li",{parentName:"ul"},"You should understand how RISC-V interfaces with memory."),(0,a.kt)("li",{parentName:"ul"},"You should understand CALLER/CALLEE conventions in RISC-V.")),(0,a.kt)("h2",{id:"exercise-2-write-a-function-without-branches"},"Exercise 2: Write a function without branches"),(0,a.kt)("p",null,"Consider the discrete-valued function ",(0,a.kt)("inlineCode",{parentName:"p"},"f")," defined on integers in the set ",(0,a.kt)("inlineCode",{parentName:"p"},"{-3, -2, -1, 0, 1, 2, 3}"),". Here\u2019s the function definition:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"f(-3) = 6\nf(-2) = 61\nf(-1) = 17\nf(0) = -38\nf(1) = 19\nf(2) = 42\nf(3) = 5\n\n")),(0,a.kt)("h3",{id:"action-item-1"},"Action Item"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Implement the function in ",(0,a.kt)("inlineCode",{parentName:"li"},"discrete_fn.s")," in RISC-V, with the condition that your code may ",(0,a.kt)("strong",{parentName:"li"},"NOT")," use any branch and/or jump instructions!"),(0,a.kt)("li",{parentName:"ol"},"Save your corrected code in a file ",(0,a.kt)("inlineCode",{parentName:"li"},"discrete_fn.s"),".")),(0,a.kt)("p",null,"Hint: How do you load a word from a dynamic address?"),(0,a.kt)("h2",{id:"checkoff"},"Checkoff"),(0,a.kt)("p",null,"Please submit to the Lab Autograder assignment (same as last week!)."))}m.isMDXComponent=!0}}]);