"use strict";(self.webpackChunklearncs_set=self.webpackChunklearncs_set||[]).push([[9478],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(r),m=a,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return r?n.createElement(h,i(i({ref:t},c),{},{components:r})):n.createElement(h,i({ref:t},c))}));function h(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},6107:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=r(7462),a=(r(7294),r(3905));const o={sidebar_position:3,description:"cs50x problem set recover",title:"recover"},i="Recover - CS50x 2023",l={unversionedId:"curriculum-resource/cs50x/lecture5/problem set/recover",id:"curriculum-resource/cs50x/lecture5/problem set/recover",title:"recover",description:"cs50x problem set recover",source:"@site/docs/curriculum-resource/cs50x/lecture5/problem set/recover.md",sourceDirName:"curriculum-resource/cs50x/lecture5/problem set",slug:"/curriculum-resource/cs50x/lecture5/problem set/recover",permalink:"/docs/curriculum-resource/cs50x/lecture5/problem set/recover",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,description:"cs50x problem set recover",title:"recover"},sidebar:"tutorialSidebar",previous:{title:"more",permalink:"/docs/curriculum-resource/cs50x/lecture5/problem set/more"},next:{title:"reverse",permalink:"/docs/curriculum-resource/cs50x/lecture5/problem set/reverse"}},s={},p=[{value:"Background",id:"background",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Specification",id:"specification",level:2},{value:"Walkthrough",id:"walkthrough",level:2},{value:"Usage",id:"usage",level:2},{value:"Hints",id:"hints",level:2},{value:"Testing",id:"testing",level:2},{value:"How to Submit",id:"how-to-submit",level:2}],c={toc:p},u="wrapper";function d(e){let{components:t,...r}=e;return(0,a.kt)(u,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"recover---cs50x-2023"},"Recover - CS50x 2023"),(0,a.kt)("p",null,"Implement a program that recovers JPEGs from a forensic image, per the below."),(0,a.kt)("h2",{id:"background"},(0,a.kt)("a",{parentName:"h2",href:"#background"},"Background")),(0,a.kt)("p",null,"In anticipation of this problem, we spent the past several days taking photos around campus, all of which were saved on a digital camera as JPEGs on a memory card. Unfortunately, we somehow deleted them all! Thankfully, in the computer world, \u201cdeleted\u201d tends not to mean \u201cdeleted\u201d so much as \u201cforgotten.\u201d Even though the camera insists that the card is now blank, we\u2019re pretty sure that\u2019s not quite true. Indeed, we\u2019re hoping (er, expecting!) you can write a program that recovers the photos for us!"),(0,a.kt)("p",null,"Even though JPEGs are more complicated than BMPs, JPEGs have \u201csignatures,\u201d patterns of bytes that can distinguish them from other file formats. Specifically, the first three bytes of JPEGs are"),(0,a.kt)("p",null,"from first byte to third byte, left to right. The fourth byte, meanwhile, is either ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe0"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe1"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe2"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe3"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe4"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe5"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe6"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe7"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe8"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xe9"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xea"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xeb"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xec"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xed"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"0xee"),", or ",(0,a.kt)("inlineCode",{parentName:"p"},"0xef"),". Put another way, the fourth byte\u2019s first four bits are ",(0,a.kt)("inlineCode",{parentName:"p"},"1110"),"."),(0,a.kt)("p",null,"Odds are, if you find this pattern of four bytes on media known to store photos (e.g., my memory card), they demarcate the start of a JPEG. To be fair, you might encounter these patterns on some disk purely by chance, so data recovery isn\u2019t an exact science."),(0,a.kt)("p",null,"Fortunately, digital cameras tend to store photographs contiguously on memory cards, whereby each photo is stored immediately after the previously taken photo. Accordingly, the start of a JPEG usually demarks the end of another. However, digital cameras often initialize cards with a FAT file system whose \u201cblock size\u201d is 512 bytes (B). The implication is that these cameras only write to those cards in units of 512 B. A photo that\u2019s 1 MB (i.e., 1,048,576 B) thus takes up 1048576 \xf7 512 = 2048 \u201cblocks\u201d on a memory card. But so does a photo that\u2019s, say, one byte smaller (i.e., 1,048,575 B)! The wasted space on disk is called \u201cslack space.\u201d Forensic investigators often look at slack space for remnants of suspicious data."),(0,a.kt)("p",null,"The implication of all these details is that you, the investigator, can probably write a program that iterates over a copy of my memory card, looking for JPEGs\u2019 signatures. Each time you find a signature, you can open a new file for writing and start filling that file with bytes from my memory card, closing that file only once you encounter another signature. Moreover, rather than read my memory card\u2019s bytes one at a time, you can read 512 of them at a time into a buffer for efficiency\u2019s sake. Thanks to FAT, you can trust that JPEGs\u2019 signatures will be \u201cblock-aligned.\u201d That is, you need only look for those signatures in a block\u2019s first four bytes."),(0,a.kt)("p",null,"Realize, of course, that JPEGs can span contiguous blocks. Otherwise, no JPEG could be larger than 512 B. But the last byte of a JPEG might not fall at the very end of a block. Recall the possibility of slack space. But not to worry. Because this memory card was brand-new when I started snapping photos, odds are it\u2019d been \u201czeroed\u201d (i.e., filled with 0s) by the manufacturer, in which case any slack space will be filled with 0s. It\u2019s okay if those trailing 0s end up in the JPEGs you recover; they should still be viewable."),(0,a.kt)("p",null,"Now, I only have one memory card, but there are a lot of you! And so I\u2019ve gone ahead and created a \u201cforensic image\u201d of the card, storing its contents, byte after byte, in a file called ",(0,a.kt)("inlineCode",{parentName:"p"},"card.raw"),". So that you don\u2019t waste time iterating over millions of 0s unnecessarily, I\u2019ve only imaged the first few megabytes of the memory card. But you should ultimately find that the image contains 50 JPEGs."),(0,a.kt)("h2",{id:"getting-started"},(0,a.kt)("a",{parentName:"h2",href:"#getting-started"},"Getting Started")),(0,a.kt)("p",null,"Log into ",(0,a.kt)("a",{parentName:"p",href:"https://cs50.dev/"},"cs50.dev"),", click on your terminal window, and execute ",(0,a.kt)("inlineCode",{parentName:"p"},"cd")," by itself. You should find that your terminal window\u2019s prompt resembles the below:"),(0,a.kt)("p",null,"Next execute"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"wget https://cdn.cs50.net/2022/fall/psets/4/recover.zip\n\n")),(0,a.kt)("p",null,"in order to download a ZIP called ",(0,a.kt)("inlineCode",{parentName:"p"},"recover.zip")," into your codespace."),(0,a.kt)("p",null,"Then execute"),(0,a.kt)("p",null,"to create a folder called ",(0,a.kt)("inlineCode",{parentName:"p"},"recover"),". You no longer need the ZIP file, so you can execute"),(0,a.kt)("p",null,"and respond with \u201cy\u201d followed by Enter at the prompt to remove the ZIP file you downloaded."),(0,a.kt)("p",null,"Now type"),(0,a.kt)("p",null,"followed by Enter to move yourself into (i.e., open) that directory. Your prompt should now resemble the below."),(0,a.kt)("p",null,"Execute ",(0,a.kt)("inlineCode",{parentName:"p"},"ls")," by itself, and you should see two files: ",(0,a.kt)("inlineCode",{parentName:"p"},"recover.c")," and \u2018card.raw","`","."),(0,a.kt)("h2",{id:"specification"},(0,a.kt)("a",{parentName:"h2",href:"#specification"},"Specification")),(0,a.kt)("p",null,"Implement a program called ",(0,a.kt)("inlineCode",{parentName:"p"},"recover")," that recovers JPEGs from a forensic image."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Implement your program in a file called ",(0,a.kt)("inlineCode",{parentName:"li"},"recover.c")," in a directory called ",(0,a.kt)("inlineCode",{parentName:"li"},"recover"),"."),(0,a.kt)("li",{parentName:"ul"},"Your program should accept exactly one command-line argument, the name of a forensic image from which to recover JPEGs."),(0,a.kt)("li",{parentName:"ul"},"If your program is not executed with exactly one command-line argument, it should remind the user of correct usage, and ",(0,a.kt)("inlineCode",{parentName:"li"},"main")," should return ",(0,a.kt)("inlineCode",{parentName:"li"},"1"),"."),(0,a.kt)("li",{parentName:"ul"},"If the forensic image cannot be opened for reading, your program should inform the user as much, and ",(0,a.kt)("inlineCode",{parentName:"li"},"main")," should return ",(0,a.kt)("inlineCode",{parentName:"li"},"1"),"."),(0,a.kt)("li",{parentName:"ul"},"The files you generate should each be named ",(0,a.kt)("inlineCode",{parentName:"li"},"###.jpg"),", where ",(0,a.kt)("inlineCode",{parentName:"li"},"###")," is a three-digit decimal number, starting with ",(0,a.kt)("inlineCode",{parentName:"li"},"000")," for the first image and counting up."),(0,a.kt)("li",{parentName:"ul"},"Your program, if it uses ",(0,a.kt)("inlineCode",{parentName:"li"},"malloc"),", must not leak any memory.")),(0,a.kt)("h2",{id:"walkthrough"},(0,a.kt)("a",{parentName:"h2",href:"#walkthrough"},"Walkthrough")),(0,a.kt)("h2",{id:"usage"},(0,a.kt)("a",{parentName:"h2",href:"#usage"},"Usage")),(0,a.kt)("p",null,"Your program should behave per the examples below."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ ./recover\nUsage: ./recover IMAGE\n\n")),(0,a.kt)("p",null,"where ",(0,a.kt)("inlineCode",{parentName:"p"},"IMAGE")," is the name of the forensic image. For example:"),(0,a.kt)("h2",{id:"hints"},(0,a.kt)("a",{parentName:"h2",href:"#hints"},"Hints")),(0,a.kt)("p",null,"Keep in mind that you can open ",(0,a.kt)("inlineCode",{parentName:"p"},"card.raw")," programmatically with ",(0,a.kt)("inlineCode",{parentName:"p"},"fopen"),", as with the below, provided ",(0,a.kt)("inlineCode",{parentName:"p"},"argv[1]")," exists."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'FILE *file = fopen(argv[1], "r");\n\n')),(0,a.kt)("p",null,"When executed, your program should recover every one of the JPEGs from ",(0,a.kt)("inlineCode",{parentName:"p"},"card.raw"),", storing each as a separate file in your current working directory. Your program should number the files it outputs by naming each ",(0,a.kt)("inlineCode",{parentName:"p"},"###.jpg"),", where ",(0,a.kt)("inlineCode",{parentName:"p"},"###")," is three-digit decimal number from ",(0,a.kt)("inlineCode",{parentName:"p"},"000")," on up. Befriend ",(0,a.kt)("a",{parentName:"p",href:"https://man.cs50.io/3/sprintf"},(0,a.kt)("inlineCode",{parentName:"a"},"sprintf"))," and note that ",(0,a.kt)("inlineCode",{parentName:"p"},"sprintf")," stores a formatted string at a location in memory. Given the prescribed ",(0,a.kt)("inlineCode",{parentName:"p"},"###.jpg")," format for a JPEG\u2019s filename, how many bytes should you allocate for that string? (Don\u2019t forget the NUL character!)"),(0,a.kt)("p",null,"You need not try to recover the JPEGs\u2019 original names. To check whether the JPEGs your program spit out are correct, simply double-click and take a look! If each photo appears intact, your operation was likely a success!"),(0,a.kt)("p",null,"Odds are, though, the JPEGs that the first draft of your code spits out won\u2019t be correct. (If you open them up and don\u2019t see anything, they\u2019re probably not correct!) Execute the command below to delete all JPEGs in your current working directory."),(0,a.kt)("p",null,"If you\u2019d rather not be prompted to confirm each deletion, execute the command below instead."),(0,a.kt)("p",null,"Just be careful with that ",(0,a.kt)("inlineCode",{parentName:"p"},"-f")," switch, as it \u201cforces\u201d deletion without prompting you."),(0,a.kt)("p",null,"If you\u2019d like to create a new type to store a byte of data, you can do so via the below, which defines a new type called ",(0,a.kt)("inlineCode",{parentName:"p"},"BYTE")," to be a ",(0,a.kt)("inlineCode",{parentName:"p"},"uint8_t")," (a type defined in ",(0,a.kt)("inlineCode",{parentName:"p"},"stdint.h"),", representing an 8-bit unsigned integer)."),(0,a.kt)("p",null,"Keep in mind, too, that you can read data from a file using ",(0,a.kt)("a",{parentName:"p",href:"https://man.cs50.io/3/fread"},(0,a.kt)("inlineCode",{parentName:"a"},"fread")),", which will read data from a file into a location in memory. Per its ",(0,a.kt)("a",{parentName:"p",href:"https://man.cs50.io/3/fread"},"manual page"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"fread")," returns the number of bytes that it has read, in which case it should either return ",(0,a.kt)("inlineCode",{parentName:"p"},"512")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"0"),", given that ",(0,a.kt)("inlineCode",{parentName:"p"},"card.raw")," contains some number of 512-byte blocks. In order to read every block from ",(0,a.kt)("inlineCode",{parentName:"p"},"card.raw"),", after opening it with ",(0,a.kt)("inlineCode",{parentName:"p"},"fopen"),", it should suffice to use a loop like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"while (fread(buffer, 1, BLOCK_SIZE, raw_file) == BLOCK_SIZE)\n{\n\n\n}\n\n")),(0,a.kt)("p",null,"That way, as soon as ",(0,a.kt)("inlineCode",{parentName:"p"},"fread")," returns ",(0,a.kt)("inlineCode",{parentName:"p"},"0")," (which is effectively ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),"), your loop will end."),(0,a.kt)("h2",{id:"testing"},(0,a.kt)("a",{parentName:"h2",href:"#testing"},"Testing")),(0,a.kt)("p",null,"Execute the below to evaluate the correctness of your code using ",(0,a.kt)("inlineCode",{parentName:"p"},"check50"),". But be sure to compile and test it yourself as well!"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"check50 cs50/problems/2023/x/recover\n\n")),(0,a.kt)("p",null,"Execute the below to evaluate the style of your code using ",(0,a.kt)("inlineCode",{parentName:"p"},"style50"),"."),(0,a.kt)("h2",{id:"how-to-submit"},(0,a.kt)("a",{parentName:"h2",href:"#how-to-submit"},"How to Submit")),(0,a.kt)("p",null,"In your terminal, execute the below to submit your work."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"submit50 cs50/problems/2023/x/recover\n\n")))}d.isMDXComponent=!0}}]);